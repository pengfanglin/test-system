<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>报名信息</title>
		<link rel="stylesheet" href="css/aui.2.1.css">
		<link rel="stylesheet" href="css/style.css">
		<style>
			.img_sm {
				padding-top: 28.125%;
				position: relative;
			}
			.img_sm_content {
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				justify-content: center;
			}
			.img_sm_content span{
				display: inline-block;
			}
			.width90 {
				width:100%;
				text-align: right;
				display: block;
				font-size: .8rem;
			}
			.file-word span {
				color: #666;
				font-size: 14px;
			}
			@media screen and (max-width: 450px){
				.width100 {
					width: 34%;
				}
				.footer{    padding: 10% 20px ; }
			}
			.link { color: #666;font-size: .6rem	}
			.code {margin-left: 20px}
		</style>
	</head>
	<body>
		<div class="content prow15 footer">
			<form action=""   class="formcase" id="form1" enctype="multipart/form-data">
				<div class="flex-center02">
					<div class="widthp50 yulanimg tac fs50 img_sm">
						<div class="img_sm_content flex-justify">
							<span>+</span>
							<img src="" id="yulanimg" class="widthp100 hide" height="100%">
						</div>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">
							头像上传：
						</div>

					</div>
					<div class="calc100 flex-justify">
						<div class="widthp100">
							<div class="file-case">
								<input type="file" class="file" name="" id="photo" value="" required/>
								<div class="file-word"><span>选择图片</span></div>
							</div>
						</div>
					</div>
				</div>

				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">
							姓名：
						</div>

					</div>
					<div class="calc100">
						<input type="text" class="input" name="name" id="name" value="" placeholder="请输入姓名" required/>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">
							电话：
						</div>

					</div>
					<div class="calc100">
						<input type="tel" maxlength="11" class="input" name="mobile" id="phone" value="" placeholder="请输入电话" required oninput = "value=value.replace(/[^\d]/g,'')"/>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">
							验证码：
						</div>

					</div>
					<div class="calc100">
						<input type="text" class="input" name="code" id="" value="" placeholder="请输入验证码" required/>
					</div>
					<div class="code">获取验证码</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">
						身份证号码：
						</div>

					</div>
					<div class="calc100">
						<input type="text" class="input" name="id_card" id="id_card" value="" placeholder="请输入身份证号码" required/>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">
							报考科目：
						</div>

					</div>
					<div class="calc100 flex-justify">
						<div class="widthp50 pr10">
							<select name="profession" id="profession">
								<option value="">请选择科目</option>
							</select>
						</div>
						<div class="widthp50 pl10">
							<select name="level" id="level">
								<option value="">请选择等级</option>
							</select>
						</div>
					</div>
				</div>

				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">
							报考机构：
						</div>

					</div>
					<div class="calc100 input-case-bg">
						<select id="institution" name="institution_name" required>
							<option value="">请选择报考机构</option>
						</select>
						<div class="select-single">
							<span class="iconfont icon-arrow_down_full fs18"></span>
						</div>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">
							费用说明：
						</div>

					</div>
					<div class="calc100">
						<a href="" class="link">链接</a>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">
							城市：
						</div>

					</div>
					<div class="calc100 input-case-bg">
						<select id="s_province" name="" required></select>
						<div class="select-single">
							<span class="iconfont icon-arrow_down_full fs18"></span>
						</div>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						
					</div>
					<div class="calc100">
						<div class="flex">
							<div class="flex-item pr5">
								<div class="height35 input-case-bg widthp100">
									<select id="s_city" name="" required></select>
									<div class="select-single">
										<span class="iconfont icon-arrow_down_full fs18"></span>
									</div>
								</div>
							</div>
							<div class="flex-item pl5">
								<div class="height35 input-case-bg widthp100">
									<select id="s_county" name="" required></select>
									<script class="resources library" src="js/area.js" type="text/javascript"></script>
									<script type="text/javascript">
										_init_area();
									</script>
									<div class="select-single">
										<span class="iconfont icon-arrow_down_full fs18"></span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
					</div>
					<div class="calc100">
						<input type="text" required class="input" id="addressDetail" name="" value="" placeholder="请输入详细地址"/>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">价格：</div>
					</div>
					<div class="calc100">
						<input type="text" required class="input" name="" id="" value="" placeholder="请输入价格"/>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">指导老师姓名：</div>
					</div>
					<div class="calc100">
						<input type="text" required class="input" name="teacher_name" id="" value="" placeholder="请输入老师姓名"/>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">老师电话：</div>
					</div>
					<div class="calc100">
						<input type="text" required class="input" name="teacher_phone" id="" value="" placeholder="请输入老师电话"/>
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">推荐机构：</div>
					</div>
					<div class="calc100">
						<input type="text" required class="input" name="recommend_institution" id="" value="" placeholder="请输入推荐机构"  />
					</div>
				</div>
				<div class="flex-justify height40 widthp100 flex-wrap" style="    align-items: flex-start;">
					<div class="width100 flex-justify">
						<div class="flex-justify width90">备注：</div>
					</div>
					<div class="calc100">
						<!--<input type="text" required class="input" name="" id="" value="" placeholder="填写备注"/>-->
						<textarea rows="3" name="note" placeholder="填写备注" value="" class="input" style="height: auto"></textarea>
					</div>
				</div>
				<div class="ajaxsubmit">
					<p  class="widthp100 height35 input submit" name="" id="submit"  >提交</p>
				</div>
			</form>
		</div>
	</body>
	<!-- <script src="js/jquery.min.js"></script> -->
	<script src="js/jquery-2.1.4.min.js"></script>
	<script>
		// 机构列表
		$.ajax({
			url:'http://exam.qubaotang.cn/api/institutionController/getInstitutionList',
			type: "post",
			success:function (result) {
				var data=result.data;
				for (var i=0;i<data.length;i++){
					$('#institution').append("<option value ='"+data[i].account_id+"'>"+data[i].institution_name+"</option>")
				}
			},
			error:function (result) {
				console.log(result);//打印服务端返回的数据(调试用)
			}
		})
		// 专业列表
		$.ajax({
			url:'http://exam.qubaotang.cn/api/institutionController/getExamListDistrict',
			type: "post",
			success:function (result) {
				var data=result.data;
				// console.log(data)
				for (var i=0;i<data.length;i++){
					$('#profession').append("<option value ='"+data[i].exam_name+"'>"+data[i].exam_name+"</option>")
				}
			},
			error:function (result) {
				console.log(result);//打印服务端返回的数据(调试用)
			}
		});

		document.getElementById('profession').onchange=function(){
			var exam_name=$(this).val();
			 var url='http://exam.qubaotang.cn/api/institutionController/getExamList?exam_name='+exam_name;
			$.ajax({
				url:url,
				type: "post",
				success:function (result) {
					var data=result.data;
					// console.log(data)
					$('#level').html('')
					for (var i=0;i<data.length;i++){
						$('#level').append("<option value ='"+data[i].level+"'>"+data[i].level+"</option>")
					}
				},
				error:function (result) {
					console.log(result);//打印服务端返回的数据(调试用)
				}
			})
		}
		// 专业等级
		$.ajax({
			url:'http://exam.qubaotang.cn/api/institutionController/getExamList',
			type: "post",

			success:function (result) {
				var data=result.data;
				// console.log(data)
				for (var i=0;i<data.length;i++){
					$('#level').append("<option value ='"+data[i].level+"'>"+data[i].level+"</option>")
				}
			},
			error:function (result) {
				console.log(result);//打印服务端返回的数据(调试用)
			}
		})
	</script>
	<script type="text/javascript">
		
		/* 图片预览 */
		$('.file').on('change',function(e){
			var file=e.target.files[0];
			//console.log(file)
			var fileread=new FileReader();
			
			fileread.onload=function(e){
				//console.log(e.target.result)
				$('.yulanimg span').hide();
			  $('#yulanimg').removeClass('hide').attr('src',e.target.result);
			}
			fileread.readAsDataURL(file);
		})

		// 验证手机号码
        function checkPhone(){
            var phone = document.getElementById('phone').value;
            if(!(/^1(3|4|5|7|8)\d{9}$/.test(phone))){
                alert("手机号码有误，请重填");
                return false;
            }else{
            	return  true;
			}
        }

        $('.code').on('click',function () {
            checkPhone()
        })

	function checkImg() {
		var animateimg = $("#photo").val(); //获取上传的图片名 带//
		if(animateimg.length==0){
			alert('请上传图片')
			return false;
		}
		var imgarr=animateimg.split('\\'); //分割
		var myimg=imgarr[imgarr.length-1]; //去掉 // 获取图片名
		var houzui = myimg.lastIndexOf('.'); //获取 . 出现的位置
		var ext = myimg.substring(houzui, myimg.length).toUpperCase();  //切割 . 获取文件后缀
		var file = $('#photo').get(0).files[0]; //获取上传的文件
		var fileSize = file.size;           //获取上传的文件大小
		var maxSize = 1048576;              //最大1MB
		if(ext !='.PNG' && ext !='.GIF' && ext !='.JPG' && ext !='.JPEG' && ext !='.BMP'){
			alert('文件类型错误,请上传图片类型');
			return false;
		}else if(parseInt(fileSize) >= parseInt(maxSize)){
			alert('上传的文件不能超过1MB');
			return false;
		}else {
			return true
		}
	}

	$('#submit').on('click',function () {
		var address=$('#s_province').val()+$('#s_city').val()+$('#s_county').val()+$('#addressDetail').val();
		var data = new FormData($('#form1')[0]);
		// var data=$('#form1').serialize();
		data.append('address',address);
		data.append('photo','')
	if(checkImg()) {
		var imgFormData=new FormData();
		imgFormData.append('photo', $('#photo')[0].files[0]);  //添加图片信息的参数
		$.ajax({
			url: "http://exam.qubaotang.cn/api/othersController/uploadFiles",
			type: 'POST',
			data: imgFormData,
			dataType: 'JSON',
			cache: false,
			processData: false,
			contentType: false,
			success:function (result) {
				if (result.resultCode == 200) {
					alert("SUCCESS");
				}
				console.log('头像success')
			},
			error:function (result) {
				console.log(result)
				alert('提交失败')
			}
		});
		$.ajax({
			url: "http://exam.qubaotang.cn/api/institutionController/studentSignUp",
			type: 'POST',
			data: data,
			dataType: 'JSON',
			cache: false,
			processData: false,
			contentType: false,
			success:function (result) {
				if (result.resultCode == 200) {
					alert("SUCCESS");
				};
				alert('success')
			},
			error:function (result) {
				console.log(result)
				alert('提交失败')
			}
		})
	}
		return false;
	})
	</script>
</html>